FROM ghcr.io/llm-d/llm-d-cuda:v0.3.1

USER root

# Install OpenTelemetry packages for vLLM tracing
# Use uv which is available system-wide
# Note: Relaxed version constraints to allow FastAPI instrumentation dependencies
RUN uv pip install \
  'opentelemetry-sdk>=1.26.0' \
  'opentelemetry-api>=1.26.0' \
  'opentelemetry-exporter-otlp>=1.26.0' \
  'opentelemetry-semantic-conventions-ai>=0.4.1' \
  'opentelemetry-instrumentation-fastapi>=0.48b0' && \
  # Fix ownership - ensure vllm user can write to venv and home
  chown -R 2000:0 /opt/vllm /home/vllm && \
  chmod -R g+rwX /home/vllm

USER 2000
