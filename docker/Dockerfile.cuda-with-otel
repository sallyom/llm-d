ARG BASE_IMAGE=ghcr.io/llm-d/llm-d-cuda:v0.4.0
FROM ${BASE_IMAGE}
USER root

# Install OpenTelemetry packages for vLLM tracing
RUN uv pip install --system \
  'opentelemetry-sdk>=1.39.1' \
  'opentelemetry-api>=1.39.1' \
  'opentelemetry-exporter-otlp>=1.39.1' \
  'opentelemetry-semantic-conventions-ai>=0.4.13' \
  'opentelemetry-instrumentation-fastapi>=0.60b1' && \
  # Fix ownership - ensure vllm user can write to venv and home
  chown -R 2000:0 /opt/vllm /home/vllm && \
  chmod -R g+rwX /home/vllm

USER 2000
